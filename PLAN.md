# План разработки мобильного приложения "AI Vision"

На основе референса (`reference.jpg`) и детального обсуждения был составлен следующий пошаговый план разработки мобильного приложения на Flutter.

## Этап 1: Фундамент, аутентификация и главный экран

1.  **Настройка проекта и темы:**

    - Подобрать и интегрировать похожий бесплатный шрифт (например, из Google Fonts).
    - Настроить глобальную тему приложения (`ThemeData`) с основной цветовой схемой (белый фон, черный текст, акцентный зеленый).
    - Создать базовую структуру папок, включая общую папку `widgets`.
    - Добавить необходимые зависимости в `pubspec.yaml`:
      - `http` для сетевых запросов.
      - `image_picker` для выбора изображений из галереи.
      - `camera` и `google_ml_kit_face_detection` для сканирования лица в реальном времени.
      - `flutter_secure_storage` для безопасного хранения токенов.

2.  **Экраны и логика аутентификации:**

    - Сверстать экраны регистрации (`/signup`) и входа (`/login`).
    - Создать сервис `AuthService` для взаимодействия с API бэкенда.
    - Реализовать сохранение и обновление JWT токенов (access, refresh) с использованием `flutter_secure_storage`.
    - Изменить навигацию: приложение запускается сразу на главном экране без входа. Аутентификация запрашивается только после анализа, при попытке сохранить результат.

3.  **Верстка главного экрана:**
    - Создать UI главного экрана в соответствии с референсом:
      - Заголовок и описание.
      - Нижний информационный блок ("3 секунды", "Надежность", "5+").
    - Реализовать нижнее навигационное меню с тремя кнопками:
      - **Слева:** иконка календаря (функционал будет определен позже).
      - **По центру:** основная кнопка "Сканировать", выполненная в акцентном зеленом цвете.
      - **Справа:** иконка профиля пользователя для перехода к аккаунту и истории анализов.

## Этап 2: Основная функциональность и интеграция

1.  **Выбор изображения из галереи:**

    - Реализовать логику для кнопки "Загрузить фото".
    - Обработать запросы на доступ к галерее и показать простое уведомление об ошибке при отказе.
    - **Не реализовывать** предпросмотр и редактирование изображения.

2.  **Реализация сканирования с камеры:**

    - Интегрировать `camera` для отображения превью с камеры.
    - Подключить `google_ml_kit_face_detection` для распознавания лица.
    - Реализовать логику 3-секундной стабилизации. Кнопка для снимка становится активной, только если все следующие условия выполняются в течение 2 секунд:
      - В кадре обнаружено ровно одно лицо.
      - Размер лица находится в оптимальных границах (не слишком близко и не слишком далеко).
      - Лицо пользователя выровнено по центру направляющего овала на экране.

3.  **Взаимодействие с API анализов:**
    - Создать сервис `ApiService` для отправки изображения (multipart/form-data) на эндпоинт `POST /analyses`. Запросы для анонимных пользователей будут отправляться без токена авторизации.
    - Реализовать отображение простого полноэкранного лоадера на время загрузки и анализа.
    - После успешного анализа отображать экран с результатами, на котором будет кнопка "Сохранить". Нажатие на нее будет запускать процесс аутентификации.
    - Обработать успешные ответы и ошибки от сервера.

## Этап 3: История анализов

1.  **Экран истории:**

    - Создать новый экран для отображения истории анализов.
    - Реализовать запрос к `GET /analyses` для получения списка предыдущих сканирований.
    - Отобразить историю в виде простого списка (например: дата и миниатюра фото, полученная по `image_path` из ответа).
    - Хранение истории будет осуществляться на бэкенде (PostgreSQL + MinIO).

2.  **Навигация:**
    - Переход на экран истории будет осуществляться через иконку профиля в нижнем навигационном меню.

## Отложенные задачи (Опционально / После MVP)

- Адаптивная верстка для разных размеров экрана.
- Анимации интерфейса.
- Детальный экран результатов анализа (на данный момент фокусируемся на истории).
